-----
### ê°œìš”
-----
1. ìµœì‹  ë°©ì‹ì˜ CSRF ê³µê²© ë°©ì–´ ë°©ë²• ì¤‘ í•˜ë‚˜ë¡œì„œ ì„œë²„ê°€ ì¿ í‚¤ë¥¼ ì„¤ì •í•  ë•Œ SameSite ì†ì„±ì„ ì§€ì •í•˜ì—¬ í¬ë¡œìŠ¤ ì‚¬ì´íŠ¸ ê°„ ì¿ í‚¤ ì „ì†¡ì— ëŒ€í•œ ì œì–´ë¥¼ í•¸ë“¤ë§ í•  ìˆ˜ ìˆìŒ
2. Spring SecurityëŠ” ì„¸ì…˜ ì¿ í‚¤ì˜ ìƒì„±ì„ ì§ì ‘ ì œì–´í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì—, SameSite ì†ì„±ì— ëŒ€í•œ ì§€ì›ì„ ì œê³µí•˜ì§€ ì•Šì§€ë§Œ, Spring Sessionì€ SameSite ì†ì„±ì„ ì§€ì›

-----
### SameSite ì†ì„±
-----
1. Strict
   - ë™ì¼ ì‚¬ì´íŠ¸ì—ì„œ ì˜¤ëŠ” ëª¨ë“  ìš”ì²­ì— ì¿ í‚¤ê°€ í¬í•¨ë˜ê³  í¬ë¡œìŠ¤ ì‚¬ì´íŠ¸ ê°„ HTTP ìš”ì²­ì— ì¿ í‚¤ê°€ í¬í•¨ë˜ì§€ ì•ŠìŒ
<div align="center">
<img src="https://github.com/user-attachments/assets/6486517a-dce7-4e52-981d-f47b8fed5c17">
</div>

2. Lax (ê¸°ë³¸ ì„¤ì •)
   - ë™ì¼ ì‚¬ì´íŠ¸ì—ì„œ ì˜¤ê±°ë‚˜ Top Level Navigationì—ì„œ ì˜¤ëŠ” ìš”ì²­ ë° ë©”ì†Œë“œê°€ ì½ê¸° ì „ìš©ì¸ ê²½ìš° ì¿ í‚¤ê°€ ì „ì†¡ë˜ê³  ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ HTTP ìš”ì²­ì— ì¿ í‚¤ê°€ í¬í•¨ë˜ì§€ ì•ŠìŒ
   - ì‚¬ìš©ìê°€ ë§í¬(```<a>```)ë¥¼ í´ë¦­í•˜ê±°ë‚˜ window.location.replace, 302 Redirect ë“±ì˜ ì´ë™ì´ í¬í•¨
   - ê·¸ëŸ¬ë‚˜ ```<iframe>```ì´ë‚˜ ```<img>```ë¥¼ ë¬¸ì„œì— ì‚½ì…, AJAX í†µì‹  ë“±ì€ ì¿ í‚¤ê°€ ì „ì†¡ë˜ì§€ ì•ŠìŒ
<div align="center">
<img src="https://github.com/user-attachments/assets/b78f4154-2aa1-4214-8e12-8471f1aab89e">
</div>

3. None
   - ë™ì¼ ì‚¬ì´íŠ¸ ë° í¬ë¡œìŠ¤ ì‚¬ì´íŠ¸ ìš”ì²­ì˜ ê²½ìš°ì—ë„ ì¿ í‚¤ê°€ ì „ì†¡
   - ì´ ëª¨ë“œì—ì„œëŠ” HTTSì— ì˜í•œ Secure ì¿ í‚¤ë¡œ ì„¤ì •ë˜ì–´ì•¼ í•¨
<div align="center">
<img src="https://github.com/user-attachments/assets/d8064469-1e8c-4996-93d5-cec18877dd0c">
</div>

-----
### SameSite ì˜ˆì‹œ
-----
<div align="center">
<img src="https://github.com/user-attachments/assets/b3b28008-4794-40a2-b956-cc10f2a69a5f">
</div>

1. ëŒ€ë¶€ë¶„ì˜ í˜„ëŒ€ ë¸Œë¼ìš°ì €ëŠ” SameSite ì†ì„±ì„ ì§€ì›í•˜ì§€ë§Œ, ì—¬ì „íˆ ì‚¬ìš© ì¤‘ì¸ ì˜¤ë˜ëœ ë¸Œë¼ìš°ì €ëŠ” ì§€ì›í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ
2. ğŸ’¡ SameSiteë¥¼ CSRF ê³µê²©ì— ëŒ€í•œ ìœ ì¼í•œ ë°©ì–´ ìˆ˜ë‹¨ìœ¼ë¡œì„œê°€ ì•„ë‹ˆë¼ ì‹¬ì¸µì ìœ¼ë¡œ ê°•í™”ëœ ë°©ì–´ì˜ ì¼í™˜ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•˜ê³  ìˆìŒ

-----
### Spring Sessionìœ¼ë¡œ SameSite ì ìš©
-----
```gradle
implementation group: 'org.springframework.session', name: 'spring-session-core', version: '3.2.1'
```
```java
@Configuration
@EnableSpringHttpSession // JSESSIONID(WAS)ê°€ ì•„ë‹Œ SESSION(Spring Session)ìœ¼ë¡œ ë°œê¸‰
public class HttpSessionConfig {
    @Bean
    public CookieSerializer cookieSerializer() { // ì„¸ì…˜ ì¿ í‚¤ ìƒì„±
        DefaultCookieSerializer serializer = new DefaultCookieSerializer();
        serializer.setUseSecureCooke(true); // ì¿ í‚¤ë¥¼ ë³´ì•ˆ ì¿ í‚¤ë¡œ ì‚¬ìš©
        serializer.setUseHttpOnlyCookie(true); // ì¿ í‚¤ë¥¼ HTTP í†µì‹ ì—ë§Œ ì‚¬ìš©
        serializer.setSameSite("Lax"); // SameSite ì„¤ì •
        return serializer;
    }

    @Bean
    public SessionRepository<MapSession> sessionRepository() {
        return new MapSessionRepository(new ConcurrentHashMap<> ());
    }
}
```

-----
### ì½”ë“œ
-----
1. HttpSessionConfig
```java
package io.security.springsecuritymaster;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.session.MapSession;
import org.springframework.session.MapSessionRepository;
import org.springframework.session.SessionRepository;
import org.springframework.session.config.annotation.web.http.EnableSpringHttpSession;
import org.springframework.session.web.http.CookieSerializer;
import org.springframework.session.web.http.DefaultCookieSerializer;

import java.util.concurrent.ConcurrentHashMap;

@Configuration
@EnableSpringHttpSession
public class HttpSessionConfig {

    @Bean
    public CookieSerializer cookieSerializer() {
        DefaultCookieSerializer serializer = new DefaultCookieSerializer();

        serializer.setUseSecureCookie(true);
        serializer.setUseHttpOnlyCookie(true);
        serializer.setSameSite("None"); // Strict, Lax

        return serializer;
    }

    @Bean
    public SessionRepository<MapSession> sessionRepository() {
        return new MapSessionRepository(new ConcurrentHashMap<>());
    }
}
```
<div align="center">
<img src="https://github.com/user-attachments/assets/09c0d2f2-e030-4270-be84-f2172310e25d">
</div>
