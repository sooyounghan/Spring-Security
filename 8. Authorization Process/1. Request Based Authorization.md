-----
### ê°œìš”
-----
1. Spring SecurityëŠ” ìš”ì²­ ê¸°ë°˜ ê¶Œí•œ ë¶€ì—¬ (Request Based Authorization)ì™€ ë©”ì„œë“œ ê¸°ë°˜ ê¶Œí•œ ë¶€ì—¬ (Method Based Authorization)ë¥¼ í†µí•´ ìì›ì— ëŒ€í•œ ì‹¬ì¸µì ì¸ ë°©ì–´ë¥¼ ì œê³µ
2. ìš”ì²­ ê¸°ë°˜ ê¶Œí•œ ë¶€ì—¬ëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­, ì¦‰ HttpServletRequestì— ëŒ€í•œ ê¶Œí•œ ë¶€ì—¬ë¥¼ ëª¨ë¸ë§í•˜ëŠ” ê²ƒì´ë©°, ì´ë¥¼ ìœ„í•´ HttpSecurity ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ê¶Œí•œ ê·œì¹™ì„ ì„ ì–¸í•  ìˆ˜ ìˆìŒ

-----
### ìš”ì²­ ê¸°ë°˜ ê¶Œí•œ ë¶€ì—¬ - HttpSecurity.authorizeHttpReqeusts()
-----
```java
@Bean
SecurityFilterChain defaultSecurityFilterChain(HttpSecurity http) throws Exception {
    http.authroizeHttpRequests(authorize -> authorize
        .anyRequest().authenticated()); // ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ê°€ ìµœì†Œí•œ ì¸ì¦ëœ ë³´ì•ˆ ì»¨í…ìŠ¤íŠ¸ê°€ ìˆì–´ì•¼ í•œë‹¤ê³  ì•Œë¦¼

    return http.build();
}
```

1. authorizeHttpRequests()ëŠ” ì‚¬ìš©ìì˜ ìì›ì ‘ê·¼ì„ ìœ„í•œ ìš”ì²­ ì—”ë“œí¬ì¸íŠ¸ì™€ ì ‘ê·¼ì— í•„ìš”í•œ ê¶Œí•œì„ ë§¤í•‘ì‹œí‚¤ê¸° ìœ„í•œ ê·œì¹™ì„ ì„¤ì •í•˜ëŠ” ê²ƒìœ¼ë¡œì„œ, ì„œë¸”ë¦¿ ê¸°ë°˜ ì—”ë“œí¬ì¸íŠ¸ì— ì ‘ê·¼í•˜ë ¤ë©´ authroizeHttpRequest()ì— í•´ë‹¹ ê·œì¹™ë“¤ì„ í¬í•¨í•´ì•¼ í•¨
2. authorizeHttpRequests()ì„ í†µí•´ ìš”ì²­ê³¼ ê¶Œí•œ ê·œì¹™ì´ ì„¤ì •ë˜ë©´, ë‚´ë¶€ì ìœ¼ë¡œ AuthorizationFilterê°€ ìš”ì²­ì— ëŒ€í•œ ê¶Œí•œ ê²€ì‚¬ ë° ìŠ¹ì¸ ì‘ì—…ì„ ìˆ˜í–‰

-----
### authorizeHttpRequests() API
-----
1. requestMatchers()
   - requestMatchers ë©”ì„œë“œëŠ” HTTP ìš”ì²­ì˜ URL íŒ¨í„´, HTTP ë©”ì„œë“œ, ìš”ì²­ íŒŒë¼ë¯¸í„° ë“±ì„ ê¸°ë°˜ìœ¼ë¡œ ì–´ë–¤ ìš”ì²­ì— ëŒ€í•´ì„œëŠ” íŠ¹ì • ë³´ì•ˆ ì„¤ì •ì„ ì ìš©í•˜ê³ , ë‹¤ë¥¸ ìš”ì²­ì— ëŒ€í•´ì„œëŠ” ì ìš©í•˜ì§€ ì•Šë„ë¡ ì„¸ë°€í•˜ê²Œ ì œì–´í•  ìˆ˜ ìˆë„ë¡ í•´ì¤Œ
   - ì˜ˆë¥¼ ë“¤ì–´, íŠ¹ì • API ê²½ë¡œì—ë§Œ CSRF ë³´í˜¸ë¥¼ ì ìš©í•˜ê±°ë‚˜, íŠ¹ì • ê²½ë¡œì— ëŒ€í•´ ì¸ì¦ì„ ìš”êµ¬í•˜ì§€ ì•Šë„ë¡ ì„¤ì •í•  ìˆ˜ ìˆìŒ
   - ì´ë¥¼ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë³´ì•ˆ ìš”êµ¬ ì‚¬í•­ì— ë§ì¶°ì„œ ìœ ì—°í•œ ë³´ì•ˆ ì •ì±…ì„ êµ¬ì„± ê°€ëŠ¥

```java
requestMatchers(String... urlPatterns) // ë³´í˜¸ê°€ í•„ìš”í•œ ìì› ê²½ë¡œë¥¼ í•œ ê°œ ì´ìƒ ì •ì˜

requestsMatchers(RequestMatcher... requestMatchers) // ë³´í˜¸ê°€ í•„ìš”í•œ ìì› ê²½ë¡œë¥¼ í•œ ê°œ ì´ìƒ ì •ì˜ (AntPathRequestMatchers, MvcRequestMatcher ë“±ì˜ êµ¬í˜„ì²´ ì‚¬ìš© ê°€ëŠ¥)

rqeuestMatchers(HttpMethod method, String... urlPatterns) // Http Methodì™€ ë³´í˜¸ê°€ í•„ìš”í•œ ìì› ê²½ë¡œë¥¼ í•œ ê°œ ì´ìƒ ì •ì˜
```

2. ì—”ë“œ í¬ì¸íŠ¸ & ê¶Œí•œ ë¶€ì—¬
```java
requestMatchers("/admin").hasRole("ADMIN") // ìš”ì²­ URLì´ /admin ì—”íŠ¸í¬ì¸íŠ¸ ì¼ ê²½ìš°, ADMIN ê¶Œí•œì„ í•„ìš”ë¡œ í•¨
```
  - requestMatchers("/admin") : ì—”ë“œ í¬ì¸íŠ¸ íŒ¨í„´
  - hasRole("ADMIN") : ê¶Œí•œ ê·œì¹™
  - ì´ë¥¼ ì„œë²„ì—ê²Œ ì „ë‹¬

-----
### ë³´í˜¸ ìì›ê³¼ ê¶Œí•œ ê·œì¹™ ì„¤ì •í•˜ê¸°
-----
```java
        http.authorizeHttpRequests(authorize -> authorize
                .requestMatchers("/user").hasAuthority("USER") // ì—”ë“œ í¬ì¸íŠ¸ì™€ ê¶Œí•œ ì„¤ì •. ìš”ì²­ì´ /user ì—”ë“œí¬ì¸íŠ¸ ìš”ì²­ì¸ ê²½ìš°, USER ê¶Œí•œì„ í•„ìš”ë¡œ í•¨
                .requestMatchers("/mypage/**").hasAuthority("USER") // Ant íŒ¨í„´ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ (ìš”ì²­ì´ /mypage ë˜ëŠ” í•˜ìœ„ ê²½ë¡œì¸ ê²½ìš°, USER ê¶Œí•œì„ í•„ìš”ë¡œ í•¨)
                .requestMatchers(RegexRequestMatcher.regexMatcher("/resource/[A-Za-z0-9]")).hasAuthority("USER") // ì •ê·œ í‘œí˜„ì‹ ì‚¬ìš© ê°€ëŠ¥
                .requestMatchers(HttpMethod.GET, "/**").hasAuthority("read") // HTTP METHOD ì˜µì…˜ì„ ì„¤ì •í•  ìˆ˜ ìˆìŒ
                .requestMatchers(HttpMethod.POST).hasAuthority("write") // POST ë°©ì‹ì˜ ëª¨ë“  ì—”ë“œ í¬ì¸íŠ¸ ìš”ì²­ì€ write ê¶Œí•œì„ í•„ìš”ë¡œ í•¨
                .requestMatchers(new AntPathRequestMatcher("/manager/**")).hasAuthority("MANAGER") // ì›í•˜ëŠ” RequestMatcherë¥¼ ì§ì ‘ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
                .requestMatchers("/admin/**").hasAnyAuthority("ADMIN", "MANAGER") // /admin/ ì´í•˜ì˜ ëª¨ë“  ìš”ì²­ì€ ADMINê³¼ MANAGER ê¶Œí•œ ì¤‘ í•˜ë‚˜ë¥¼ í•„ìš”ë¡œ í•¨
                .anyRequest().authenticated()); // ìœ„ì—ì„œ ì •ì˜í•œ ê·œì¹™ì— í•´ë‹¹í•˜ì§€ ì•Šìœ¼ë©´, ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ ìš”ì²­ì€ ì¸ì¦ì„ í•„ìš”ë¡œ í•¨
```

1. ğŸ’¡ ì£¼ì˜ì‚¬í•­
   - ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ëŠ” í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì— ëŒ€í•´ ìœ„ì—ì„œë¶€í„° ì•„ë˜ë¡œ ë‚˜ì—´ëœ ìˆœì„œëŒ€ë¡œ ì²˜ë¦¬í•˜ë©° ìš”ì²­ì— ëŒ€í•˜ì—¬ ì²« ë²ˆì§¸ ì¼ì¹˜ë§Œ ì ìš©ë˜ê³ , ë‹¤ìŒ ìˆœì„œë¡œ ë„˜ì–´ê°€ì§€ ì•ŠìŒ
   - /admin/**ê°€ /admin/db ìš”ì²­ì„ í¬í•¨í•˜ë¯€ë¡œ ì˜ë„í•œ ëŒ€ë¡œ ê¶Œí•œ ê·œì¹™ì´ ì˜¬ë°”ë¥´ê²Œ ì ìš©ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ
   - ê·¸ë ‡ê¸° ë•Œë¬¸ì— ì—”ë“œ í¬ì¸íŠ¸ ì„¤ì • ì‹œ ì¢ì€ ë²”ìœ„ì˜ ê²½ë¡œë¥¼ ë¨¼ì € ì •ì˜í•˜ê³ , ê·¸ê²ƒë³´ë‹¤ í° ë²”ìœ„ì˜ ê²½ë¡œë¥¼ ë‹¤ìŒ ì„¤ì •ì—ì„œ ì •ì˜í•´ì•¼í•¨ (ì¦‰, ì¢ì€ ë²”ìœ„ê°€ ë¨¼ì € ë‚˜ì™€ì•¼ í•¨)

-----
### ê¶Œí•œ ê·œì¹™ ì¢…ë¥˜
-----
<div align="center">
<img src="https://github.com/user-attachments/assets/b12dffb3-b6d4-4fc0-b069-df434fbb4639">
</div>

1. ê¶Œí•œ ê·œì¹™ìœ¼ë¡œ AuthorizationManager í´ë˜ìŠ¤ì— ì˜í•´ ì¬êµ¬ì„±
2. ëª¨ë“  ìš”ì²­ì€ ì—¬ëŸ¬ ì¢…ë¥˜ì˜ AuthorizationManagerì— ì„¤ì •ëœ ê¶Œí•œ ê·œì¹™ì— ë”°ë¼ ìŠ¹ì¸ í˜¹ì€ ê±°ë¶€

-----
### ì½”ë“œ
-----
1. SecurityConfig
```java
package io.security.springsecuritymaster;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.HttpMethod;
import org.springframework.security.config.Customizer;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.provisioning.InMemoryUserDetailsManager;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.servlet.util.matcher.MvcRequestMatcher;
import org.springframework.security.web.util.matcher.AntPathRequestMatcher;
import org.springframework.security.web.util.matcher.RegexRequestMatcher;
import org.springframework.web.servlet.handler.HandlerMappingIntrospector;


@EnableWebSecurity
@Configuration
public class SecurityConfig {
    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http, HandlerMappingIntrospector introspector) throws Exception {

        http
                .authorizeHttpRequests(authorize -> authorize
                        .requestMatchers("/","/login").permitAll()
                        .requestMatchers("/user").hasAuthority("ROLE_USER") // "/user" ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•´ "USER" ê¶Œí•œì„ ìš”êµ¬
                        .requestMatchers("/myPage/**").hasRole("USER") // "/mypage" ë° í•˜ìœ„ ë””ë ‰í„°ë¦¬ì— ëŒ€í•´ "USER" ê¶Œí•œì„ ìš”êµ¬. Ant íŒ¨í„´ ì‚¬ìš©.
                        .requestMatchers(HttpMethod.POST).hasAuthority("ROLE_WRITE") // POST ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ìš”ì²­ì— ëŒ€í•´ "write" ê¶Œí•œì„ ìš”êµ¬.
                        .requestMatchers(new AntPathRequestMatcher("/manager/**")).hasAuthority("ROLE_MANAGER") // "/manager" ë° í•˜ìœ„ ë””ë ‰í„°ë¦¬ì— ëŒ€í•´ "MANAGER" ê¶Œí•œì„ ìš”êµ¬. AntPathRequestMatcher ì‚¬ìš©.
                        .requestMatchers(new MvcRequestMatcher(introspector, "/admin/payment")).hasAuthority("ROLE_ADMIN") // "/manager" ë° í•˜ìœ„ ë””ë ‰í„°ë¦¬ì— ëŒ€í•´ "MANAGER" ê¶Œí•œì„ ìš”êµ¬. AntPathRequestMatcher ì‚¬ìš©. (SpringMVC êµ¬ì¡°ë¥¼ í†µí•©ì‹œí‚¤ê¸° ìœ„í•´ ë§Œë“  êµ¬ì¡° : MvcRequestMatcher, ë‹¨ ë§¤ê°œë³€ìˆ˜ë¡œ HandlerMappingIntrospector introspector í•„ìš”)
                        .requestMatchers("/admin/**").hasAnyAuthority("ROLE_ADMIN", "ROLE_MANAGER") // "/admin" ë° í•˜ìœ„ ë””ë ‰í„°ë¦¬ì— ëŒ€í•´ "ADMIN" ë˜ëŠ” "MANAGER" ê¶Œí•œ ì¤‘ í•˜ë‚˜ë¥¼ ìš”êµ¬.
                        .requestMatchers(new RegexRequestMatcher("/resource/[A-Za-z0-9]+", null)).hasAuthority("ROLE_MANAGER") // ì •ê·œ í‘œí˜„ì‹ì„ ì‚¬ìš©í•˜ì—¬ "/resource/[A-Za-z0-9]+" íŒ¨í„´ì— "MANAGER" ê¶Œí•œì„ ìš”êµ¬.
                        .anyRequest().authenticated())// ìœ„ì—ì„œ ì •ì˜í•œ ê·œì¹™ ì™¸ì˜ ëª¨ë“  ìš”ì²­ì€ ì¸ì¦ì„ í•„ìš”.
                .formLogin(Customizer.withDefaults())
                .csrf(AbstractHttpConfigurer::disable);

        return http.build();
    }

    @Bean
    public UserDetailsService userDetailsService() {
        UserDetails user = User.withUsername("user")
                .password("{noop}1111")
                .roles("USER")
                .build();

        UserDetails manager = User.withUsername("manager")
                .password("{noop}1111")
                .roles("MANAGER")
                .build();

        UserDetails admin = User.withUsername("admin")
                .password("{noop}1111")
                .roles("ADMIN", "WRITE")
                .build();

        return new InMemoryUserDetailsManager(user, manager, admin);
    }
}
```

2. index.html
```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Spring Security Test Page</title>
</head>
<body>
<h2>Spring Security ìš”ì²­ í…ŒìŠ¤íŠ¸</h2>
<a href="/login">ë¡œê·¸ì¸</a>
<a href="/logout">ë¡œê·¸ì•„ì›ƒ</a>
<button onclick="fetchAndDisplay('/user')">User í˜ì´ì§€ ì ‘ê·¼</button>
<button onclick="fetchAndDisplay('/myPage/points')">MyPage í˜ì´ì§€ ì ‘ê·¼</button>
<button onclick="fetchAndDisplay('/manager')">Manager í˜ì´ì§€ ì ‘ê·¼</button>
<button onclick="fetchAndDisplay('/admin/payment')">Admin Payment ì ‘ê·¼</button>
<button onclick="fetchAndDisplay('/admin')">Admin í˜ì´ì§€ ì ‘ê·¼</button>
<button onclick="fetchAndDisplay('/resource/address_01')">ì¸ì¦ì í˜ì´ì§€ ì ‘ê·¼</button>
<button onclick="fetchAndDisplay('/resource/address01')">Manager í˜ì´ì§€ ì ‘ê·¼</button>
<button onclick="sendPostRequest()">POST ìš”ì²­ ë³´ë‚´ê¸°</button>

<script>
    function fetchAndDisplay(url) {
        fetch(url)
            .then(response => {
                if (!response.ok) throw new Error('Request failed');
                return response.text();
            })
            .then(data => alert('Response: ' + data))
            .catch(error => alert('Error: ' + error));
    }

    function sendPostRequest() {
        fetch('/post', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                // 'Authorization': 'Bearer YOUR_TOKEN_HERE' // í•„ìš”í•œ ê²½ìš° ì¸ì¦ í† í° ì¶”ê°€
            },
            body: JSON.stringify({ data: 'yourDataHere' })
        })
            .then(response => {
                if (!response.ok) throw new Error('Post request failed');
                return response.text();
            })
            .then(data => alert('Post Response: ' + data))
            .catch(error => alert('Post Error: ' + error));
    }
</script>
</body>
</html>
```

3. IndexController
```java
package io.security.springsecuritymaster;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class IndexController {

    @GetMapping("/user")
    public String user(){
        return "user";
    }

    @GetMapping("/myPage/points")
    public String myPage(){
        return "myPage";
    }

    @GetMapping("/manager")
    public String manager(){
        return "manager";
    }

    @GetMapping("/admin")
    public String admin(){
        return "admin";
    }

    @GetMapping("/admin/payment")
    public String adminPayment(){
        return "adminPayment";
    }

    @GetMapping("/resource/address_01")
    public String address_01(){
        return "address_01";
    }

    @GetMapping("/resource/address01")
    public String address01(){
        return "address01";
    }

    @PostMapping("/post")
    public String post(){
        return "post";
    }

}
```

