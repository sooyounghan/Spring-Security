-----
### CORS(Cross Origin Resource Sharing, êµì°¨ ì¶œì²˜ ë¦¬ì†ŒìŠ¤ ê³µìœ )
-----
1. ì›¹ì—ì„œëŠ” ë³´ì•ˆì„ ìœ„í•´ ê¸°ë³¸ì ìœ¼ë¡œ í•œ ì›¹ í˜ì´ì§€(ì¶œì²˜ A)ì—ì„œ ë‹¤ë¥¸ ì›¹ í˜ì´ì§€(ì¶œì²˜ B)ì˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒì„ ì œí•œí•˜ëŠ”ë° ì´ë¥¼ 'ë™ì¼ ì¶œì²˜ ì •ì±…(Same-Origin Policy)'
2. ë§Œì•½, ë‹¤ë¥¸ ì¶œì²˜ì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•˜ê³ ì í•  ê²½ìš°, CORSê°€ ë“±ì¥í•˜ë©°, CORSëŠ” íŠ¹ë³„í•œ HTTP í—¤ë”ë¥¼ í†µí•´ í•œ ì›¹ í˜ì´ì§€ê°€ ë‹¤ë¥¸ ì¶œì²˜ì˜ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ 'í—ˆê°€'ë¥¼ êµ¬í•˜ëŠ” ë°©ë²•
3. ì¦‰, ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ë‹¤ë¥¸ ì¶œì²˜ì˜ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ê³ ì í•  ë•Œ, ë¸Œë¼ìš°ì €ê°€ ê·¸ ìš”ì²­ì„ ëŒ€ì‹ í•´ì„œ í•´ë‹¹ ë°ì´í„°ë¥¼ ì‚¬ìš©í•´ë„ ë˜ëŠ”ì§€ ë‹¤ë¥¸ ì¶œì²˜ì—ê²Œ ë¬¼ì–´ë³´ëŠ” ê²ƒ
4. ì¶œì²˜ë¥¼ ë¹„êµí•˜ëŠ” ë¡œì§ì€ ì„œë²„ì— êµ¬í˜„ëœ ìŠ¤í™ì´ ì•„ë‹Œ ë¸Œë¼ìš°ì €ì— êµ¬í˜„ëœ ìŠ¤í™ ê¸°ì¤€ìœ¼ë¡œ ì²˜ë¦¬ë˜ë©°, ë¸Œë¼ìš°ì €ëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ í—¤ë”ì™€ ì„œë²„ì˜ ì‘ë‹µ í—¤ë”ë¥¼ ë¹„êµí•´ì„œ ìµœì¢… ì‘ë‹µì„ ê²°ì •
5. ğŸ’¡ ë‘ ê°œì˜ ì¶œì²˜ë¥¼ ë¹„êµí•˜ëŠ” ë°©ë²•ì€ URL êµ¬ì„± ìš”ì†Œ ì¤‘ Protocol, Host, Portì´ ì„¸ ê°€ì§€ê°€ ë™ì¼í•œì§€ í™•ì¸í•˜ë©´ ë˜ê³ , ë‚˜ë¨¸ì§€ê°€ í‹€ë ¤ë„ ìƒê´€ ì—†ìŒ
<div align="Center">
<img src="https://github.com/user-attachments/assets/efd45a34-ac16-4e18-8304-92c315ff38fd">
</div>

-----
### CORS ì¢…ë¥˜
-----
1. Simple Request
   - ì˜ˆë¹„ ìš”ì²­(Preflight) ê³¼ì • ì—†ì´ ìë™ìœ¼ë¡œ CORSê°€ ì‘ë™í•˜ì—¬ ì„œë²„ì— ë³¸ ìš”ì²­ì„ í•œ í›„, ì„œë²„ê°€ ì‘ë‹µì˜ í—¤ë”ì— Access-Controll-Allow-Originê³¼ ê°™ì€ ê°’ì„ ì „ì†¡
   - ë¸Œë¼ìš°ì €ê°€ ì„œë¡œ ë¹„êµ í›„, CORS ì •ì±… ìœ„ë°˜ ì—¬ë¶€ë¥¼ ê²€ì‚¬í•˜ëŠ” ë°©ì‹
   - ì œì•½ ì‚¬í•­
     + GET, POST, HEAD ì¤‘ì˜ í•œê°€ì§€ Methodë¥¼ ì‚¬ìš©
     + í—¤ë”ëŠ” Accept, Accept-Language, Content-Language, Content-Type, DPR, Downlink, Save-Data, Viewport-Width Widthë§Œ ê°€ëŠ¥í•˜ê³ , Custom HeaderëŠ” í—ˆìš©ë˜ì§€ ì•ŠìŒ
     + Content-Typeì€ application/x-www-form-urlencoded, multipart/form-data, text/plainë§Œ ê°€ëŠ¥
<div align="Center">
<img src="https://github.com/user-attachments/assets/7cca6528-4bef-4c66-a7ed-8b5623dac06a">
</div>

2. Preflight Request (ì˜ˆë¹„ ìš”ì²­)
   - ë¸Œë¼ìš°ì €ëŠ” ìš”ì²­ì„ í•œ ë²ˆì— ë³´ë‚´ì§€ ì•Šê³ , ì˜ˆë¹„ ìš”ì²­ê³¼ ë³¸ ìš”ì²­ì„ ë‚˜ëˆ„ì–´ ì„œë²„ì— ì „ë‹¬
   - ë¸Œë¼ìš°ì €ê°€ ì˜ˆë¹„ ìš”ì²­ì„ ë³´ë‚´ëŠ” ê²ƒì„ Preflight
   - ì´ ì˜ˆë¹„ ìš”ì²­ ë©”ì„œë“œì—ëŠ” OPTIONSê°€ ì‚¬ìš© (ìš”ì²­ì— ëŒ€í•´ ì§€ì›í•˜ëŠ” HTTP ë©”ì„œë“œë¥¼ ë¯¸ë¦¬ íƒìƒ‰í•˜ê³ ì í•  ë•Œ ì‚¬ìš©)
   - ğŸ’¡ ì˜ˆë¹„ ìš”ì²­ì˜ ì—­í• ì„ ë³¸ ìš”ì²­ì„ ë³´ë‚´ê¸° ì „ ë¸Œë¼ìš°ì €ê°€ ìŠ¤ìŠ¤ë¡œ ì•ˆì „í•œ ìš”ì²­ì¸ì§€ í™•ì¸í•˜ëŠ” ê²ƒìœ¼ë¡œ ìš”ì²­ ì‚¬ì–‘ì´ Simple Requestì— í•´ë‹¹í•˜ì§€ ì•Šì„ ê²½ìš° ë¸Œë¼ìš°ì €ê°€ Preflight Requestë¥¼ ì‹¤í–‰
<div align="Center">
<img src="https://github.com/user-attachments/assets/de188357-19c9-4927-8a3d-415d32149b93">
</div>

-----
### Preflight Request (ì˜ˆë¹„ ìš”ì²­)
-----
1. A Service
<div align="Center">
<img src="https://github.com/user-attachments/assets/9fa03abf-537e-4d8b-b2b0-99037589b5eb">
</div>

  - ë¸Œë¼ìš°ì €ê°€ ë³´ë‚¸ ìš”ì²­ì„ ë³´ë©´ Originì— ëŒ€í•œ ì •ë³´ ë¿ë§Œ ì•„ë‹ˆë¼, ì˜ˆë¹„ ìš”ì²­ ì´í›„ì— ì „ì†¡í•  ë³¸ ìš”ì²­ì— ëŒ€í•œ ë‹¤ë¥¸ ì •ë³´ë“¤ë„ í•¨ê»˜ í¬í•¨ë˜ì–´ ìˆìŒì„ ì•Œ ìˆ˜ ìˆìŒ
  - ì´ ì˜ˆë¹„ ìš”ì²­ì—ì„œ Access-Contorl-Request-Headersë¥¼ ì‚¬ìš©í•˜ì—¬ ìì‹ ì´ ë³¸ ìš”ì²­ì—ì„œ Content-Type í—¤ë”ë¥¼ ì‚¬ìš©í•  ê²ƒì„ ì•Œë ¤ì£¼ê±°ë‚˜, Access-Control-Request-Methodë¥¼ ì‚¬ìš©í•˜ì—¬ GET ë©”ì„œë“œë¥¼ ì‚¬ìš©í•  ê²ƒì„ ì„œë²„ì—ê²Œ ë¯¸ë¦¬ ì•Œë ¤ì¤Œ

2. B Service (Server)
<div align="Center">
<img src="https://github.com/user-attachments/assets/7a4e5d2c-7b9b-4953-a1db-375f22b65c71">
</div>

  - ì„œë²„ê°€ ë³´ë‚´ì¤€ ì‘ë‹µ í—¤ë”ì— í¬í•¨ëœ ```Access-Contorl-Allow-Origin: https://security.io```ì˜ ì˜ë¯¸ëŠ” í•´ë‹¹ URL ì™¸ì— ë‹¤ë¥¸ ì¶œì²˜ë¡œ ìš”ì²­í•  ê²½ìš°ì—ëŠ” CORS ì •ì±…ì„ ìœ„ë°˜í–ˆë‹¤ê³  íŒë‹¨í•˜ê³  ì˜¤ë¥˜ ë©”ì„¸ì§€ë¥¼ ë‚´ê³  ì‘ë‹µì„ ë²„ë¦¬ê²Œ ë¨

-----
### ë™ì¼ ì¶œì²˜ ê¸°ì¤€
-----
<div align="Center">
<img src="https://github.com/user-attachments/assets/9b6f2cd9-93f3-4403-b011-deb0be250414">
</div>

-----
### CORS í•´ê²° : ì„œë²„ì—ì„œ Access-Contorl-Allow-* ì„¸íŒ…
-----
1. Access-Control-Allow-Origin : í—¤ë”ì— ì‘ì„±ëœ ì¶œì²˜ë§Œ ë¸Œë¼ìš°ì €ê°€ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©
   - ```*```, ```https://security.io```
  
2. Access-Control-Allow-Methods : Preflight Requestì— ëŒ€í•œ ì‘ë‹µìœ¼ë¡œ ì‹¤ì œ ìš”ì²­ ì¤‘ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë©”ì„œë“œë¥¼ ë‚˜íƒ€ëƒ„
   - ê¸°ë³¸ê°’ : GET, POST, HEAD, OPTIONS, ```*```
  
3. Access-Control-Allow-Headers : Preflight Requestì— ëŒ€í•œ ì‘ë‹µìœ¼ë¡œ ì‹¤ì œ ìš”ì²­ ì¤‘ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í—¤ë” í•„ë“œ ì´ë¦„ì„ ë‚˜íƒ€ëƒ„
   - ê¸°ë³¸ê°’ : Origin, Accept, X-Requested-With, Content-Type, Access-Control-Request-Method, Access-Control-Requst-Headers, Custom Header, ```*```
  
4. Access-Control-Allow-Credentials : ì‹¤ì œ ìš”ì²­ì— ì¿ í‚¤ë‚˜ ì¸ì¦ ë“±ì˜ ì‚¬ìš©ì ìê²© ì¦ëª…ì´ í¬í•¨ë  ìˆ˜ ìˆìŒì„ ë‚˜íƒ€ëƒ„ (Clientì˜ credentials:include ì˜µì…˜ì¼ ê²½ìš° true í•„ìˆ˜)
5. Access-Control-Max-Age : Preflight ìš”ì²­ ê²°ê³¼ë¥¼ ìºì‹œí•  ìˆ˜ ìˆëŠ” ì‹œê°„ì„ ë‚˜íƒ€ë‚´ëŠ” ê²ƒìœ¼ë¡œ í•´ë‹¹ ì‹œê°„ ë™ì•ˆì€ Prefilght ìš”ì²­ì„ ë‹¤ì‹œ í•˜ì§€ ì•Šê²Œ ë¨

-----
### cors() & CorsFilter
-----
1. CORSì˜ ì‚¬ì „ ìš”ì²­(Pre-flight Request)ì—ëŠ” ì¿ í‚¤(JSESSIONID)ê°€ í¬í•¨ë˜ì–´ ìˆì§€ ì•Šê¸° ë•Œë¬¸ì—, Spring Security ì´ì „ì— ì²˜ë¦¬ë˜ì–´ì•¼ í•¨
2. ì‚¬ì „ ìš”ì²­ì— ì¿ í‚¤ê°€ ì—†ê³ , Spring Securityê°€ ë¨¼ì € ì²˜ë¦¬ë˜ë©´, ìš”ì²­ì€ ì‚¬ìš©ìê°€ ì¸ì¦ë˜ì§€ ì•Šì•˜ë‹¤ê³  íŒë‹¨í•˜ê³  ê±°ë¶€í•  ìˆ˜ ìˆìŒ
3. CORSê°€ ë¨¼ì € ì²˜ë¦¬ë˜ë„ë¡ í•˜ê¸° ìœ„í•´ì„œëŠ” CorsFilterë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, CorsFilterì— CorsConfigurationSourceë¥¼ ì œê³µí•¨ìœ¼ë¡œì¨ Spring Securityì™€ í†µí•© í•  ìˆ˜ ìˆìŒ
```java
@Bean
SecurityFilterChain defaultSecurityFilterChain(HttpSecurity http) throws Exception {
    http.cors(cors -> cors.configurationSource(corsConfigurationSource())); // ì»¤ìŠ¤í…€í•˜ê²Œ ì‚¬ìš©í•  CorsConfigurationSourceë¥¼ ì„¤ì •
                                                                            // CorsConfigurationSourceë¥¼ ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´ Spring MVCì˜ CORS êµ¬ì„±ì„ ì‚¬ìš©
    return http.build();
}

@Bean
public CorsConfigurationSource corsConfigurationSource() {
    CorsConfiguration configuration = new CorsConfiguration();
    configuration.addAllowedOrigin("https://example.com");
    configuration.addAllowedMethod("GET", "POST");
    configuration.setAllowCredentials(true);
    UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
    source.registerCorsConfiguration("/**", configuration);
    return source;
}
```

-----
### ì½”ë“œ
-----
1. Moudel - Cors1 (Client) (Port : 8081)
   - Index.html
```html
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script>

        function corsTest(){
            fetch("http://localhost:8082/api/users",{
                method : "GET",
                headers : {
                    "Content-Type" : "text/xml",
                }
            })
                .then(response => {
                    response.json().then(function(data){
                        console.log(data)
                    })
                })
        }

    </script>
</head>
<body>
<button name="corsTest" onclick="corsTest()">corsTest</button>
</body>
</html>
```

   - IndexController
```java
package io.security.cors1;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class IndexController {
    
    @GetMapping
    public String index() {
        return "index";
    }
}
```

2. Module2 - Cors2 (Server) (Port : 8082)
   - SecurityConfig
```java
package io.security.cors2;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.provisioning.InMemoryUserDetailsManager;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.cors.CorsConfigurationSource;
import org.springframework.web.cors.UrlBasedCorsConfigurationSource;

@EnableWebSecurity
    @Configuration
    public class SecurityConfig {

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {

        http
                .authorizeHttpRequests(auth -> auth
                        .anyRequest().permitAll())
                .cors(cors -> cors.configurationSource(corsConfigurationSource()));

        return http.build();
    }

    @Bean
    public CorsConfigurationSource corsConfigurationSource() {
        CorsConfiguration configuration = new CorsConfiguration();

        configuration.addAllowedOrigin("http://localhost:8081"); // ì¶œì²˜ ì„¤ì •
        configuration.addAllowedMethod("*"); // ëª¨ë“  ë©”ì„œë“œ ì„¤ì •
        configuration.addAllowedHeader("*"); // ëª¨ë“  í—¤ë” ì„¤ì •
        configuration.setAllowCredentials(true); // ëª¨ë“  ì •ë³´(ì¿ í‚¤, ì„¸ì…˜ ë“±) ì„¤ì •
        configuration.setMaxAge(3600L); // 3600ms

        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/**", configuration); // ëª¨ë“  ê²½ë¡œì— ëŒ€í•´ ì§€ì •

        return source;
    }

    @Bean
    public UserDetailsService userDetailsService() {
        UserDetails user = User.withUsername("user")
                .password("{noop}1111")
                .roles("USER")
                .build();

        return new InMemoryUserDetailsManager(user);
    }
}
```

   - IndexController
```java
package io.security.cors2;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequestMapping("/api")
public class IndexController {
    
    @GetMapping("/users")
    public String users() {
        return "{\"name\": \"hong gil dong\"}";
    }
}
```

3. Preflight
<div align="center">
<img src="https://github.com/user-attachments/assets/be84c8b5-fc3f-4833-855e-ef0d47b6cf82">
</div>

4. ë³¸ ìš”ì²­
<div align="center">
<img src="https://github.com/user-attachments/assets/62bafea1-8f31-44dc-9af3-351b5983ef03">
</div>

5. Simple Request ì˜ˆì œ
   - index.html
```html
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script>

        function corsTest(){
            fetch("http://localhost:8082/api/users",{
                method : "GET",
                /* headers :  {
                    "Content-Type" : "text/xml",
                } */ // Simple Request ì¡°ê±´ ì¶©ì¡±
            })
                .then(response => {
                    response.json().then(function(data){
                        console.log(data)
                    })
                })
        }

    </script>
</head>
<body>
<button name="corsTest" onclick="corsTest()">corsTest</button>
</body>
</html>
```

   - ë³¸ ìš”ì²­ë§Œ ì „ì†¡
<div align="center">
<img src="https://github.com/user-attachments/assets/b185ef7b-17e4-4e96-aff1-e387108bcfbf">
</div>
