-----
### 개요
-----
1. CSRF 공격을 방지하기 위한 토큰 패턴을 사용하려면 실제 CSRF 토큰을 HTTP 요청에 포함해야 함
2. 따라서, 브라우저에 의해 HTTP 요청에 자동으로 포함되지 않는 요청 부분 (폼 매개변수, HTTP 헤더 또는 기타 부분) 중 하나에 포함되어야 함

-----
### HTML Forms
-----
1. HTML 폼을 서버에 제출하려면 CSRF 토큰을 hidden 값으로 FORM에 포함해야 함
```hmtl
<form action="/memberJoin" method="post">
<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}"/>
</form>

<input type="hidden" name="_csrf" value="4bfd1575-3ad1-4d21-96c7-4ef2d9f86721"/>
```

2. 폼에 실제 CSRF 토큰을 자동으로 포함하는 뷰
   - Thymeleaf
   - Spring 폼 태그 라이브러리 - ```<% @taglib prefix="form" uri="http://www.springframework.org/tags/form" %>```

-----
### JavaScript Applications
-----
1. Single Page Application
   - CookieCsrfTokenRepository.withHttpOnlyFalse를 사용해서 클라이언트가 서버가 발행한 쿠키로부터 CSRF 토큰을 읽을 수 있도록 함
   - 사용자 정의 CsrfTokenRequestHandler를 만들어 클라이언트가 요청 헤더나 요청 파라미터로 CSRF 토큰을 제출할 경우 이를 검증하도록 구현
   - 클라이언트 요청에 대해 CSRF 토큰을 쿠키에 렌더링해서 응답할 수 있도록 필터를 구현

<div align="center">
<img src="https://github.com/user-attachments/assets/4bd46c3d-a295-432c-b282-88f38ae78e91">
</div>

2. Multi Page Application
   - JavaScript가 각 페이지에서 로드되는 멀티 페이지 애플리케이션의 경우, CSRF 토큰을 쿠키에 노출시키는 대신 HTML 메타 태그 내 CSRF 토큰을 포함시킬 수 있음
   - HTML 메타 태그에 CSRF 토큰 포함
```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<meta name="_csrf" th:content="${_csrf.token}"/>
<meta name ="_csrf_header" th:content="${_csrf.headerName}"/>
</html>
```

  - AJAX 요청에서 CSRF 토큰 포함
```javasrcipt
function login() {
    const csrfHeader = ${'meta[name="_csrf_header"]').attr('content');
    const csrfToken = ${'meta[name="_csrf"]').attr('content');

    fetch('/api/login', {
        method: 'POST',
        headers: {[csrfHeader]: csrfToken }
    })
}
```
