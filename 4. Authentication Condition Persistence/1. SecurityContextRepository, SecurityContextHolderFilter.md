-----
### SecurityContextRepository
-----
1. ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì—ì„œ ì‚¬ìš©ìê°€ ì¸ì¦í•œ ì´í›„ ìš”ì²­ì— ëŒ€í•´ ê³„ì† ì‚¬ìš©ìì˜ ì¸ì¦ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” í´ë˜ìŠ¤
2. ì¸ì¦ ìƒíƒœì˜ ì˜ì† ë©”ì»¤ë‹ˆì¦˜ì€ ì‚¬ìš©ìê°€ ì¸ì¦ì„ í•˜ê²Œ ë˜ë©´, í•´ë‹¹ ì‚¬ìš©ìì˜ ì¸ì¦ ì •ë³´ì™€ ê¶Œí•œì´ SecurityContextì— ì €ì¥ë˜ê³ , HttpSessionì„ í†µí•´ ìš”ì²­ ê°„ ì˜ì†ì´ ì´ë£¨ì–´ì§€ëŠ” ë°©ì‹
<div align="center">
<img src="https://github.com/user-attachments/assets/4cef75a8-fc62-45f4-9785-afd61d82387e">
</div>

-----
### êµ¬ì¡°
-----
<div align="center">
<img src="https://github.com/user-attachments/assets/317b3843-ca00-474e-bdd1-1365b7517e8f">
</div>

1. HttpSessionSecurityContextRepository : ìš”ì²­ ê°„ HttpSessionì— ë³´ì•ˆ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì €ì¥, í›„ì† ìš”ì²­ ì‹œ ì»¨í…ìŠ¤íŠ¸ ì˜ì†ì„± ìœ ì§€
2. RequestAttributeSecurityContextRepository : ServletRequestì— ë³´ì•ˆ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì €ì¥, í›„ì† ìš”ì²­ ì‹œ ì»¨í…ìŠ¤íŠ¸ ì˜ì†ì„± ìœ ì§€ ë¶ˆê°€
3. NullSecurityContextRepository : ì„¸ì…˜ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì¸ì¦(JWT, OAuth2) ì¼ ê²½ìš° ì‚¬ìš©í•˜ë©°, ì»¨í…ìŠ¤íŠ¸ ê´€ë ¨ ì•„ë¬´ëŸ° ì²˜ë¦¬ë¥¼ í•˜ì§€ ì•ŠìŒ
4. DelegatingSecurityContextRepository : RequestAttributeSecurityContextRepositoryì™€ HttpSessionSecurityContextRepositoryë¥¼ ë™ì‹œì— ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ìœ„ì„ëœ í´ë˜ìŠ¤ë¡œì„œ, ì´ˆê¸°í™” ì‹œ ê¸°ë³¸ìœ¼ë¡œ ì„¤ì •

-----
### ğŸ’¡ SecurityContextHolderFilter
-----
1. SecurityContextRepositoryë¥¼ ì‚¬ìš©í•˜ì—¬ SecurityContextë¥¼ ì–»ê³ , ì´ë¥¼ SecurityContextHolderì— ì„¤ì •í•˜ëŠ” í•„í„° í´ë˜ìŠ¤
2. ì´ í•„í„° í´ë˜ìŠ¤ëŠ” SecurityContextRepository.saveContext()ë¥¼ ê°•ì œë¡œ ì‹¤í–‰ì‹œí‚¤ì§€ ì•Šê³ , ì‚¬ìš©ìê°€ ëª…ì‹œì ìœ¼ë¡œ í˜¸ì¶œë˜ì–´ì•¼ SecurityContextë¥¼ ì €ì¥í•  ìˆ˜ ìˆëŠ”ë° ì´ëŠ” SecurityContextPersistenceFilterì™€ ë‹¤ë¥¸ì 
3. ì¸ì¦ì´ ì§€ì†ë˜ì–´ì•¼ í•˜ëŠ”ì§€ë¥¼ ê° ì¸ì¦ ë©”ì»¤ë‹ˆì¦˜ì´ ë…ë¦½ì ìœ¼ë¡œ ì„ íƒí•  ìˆ˜ ìˆê²Œ í•˜ì—¬, ë” ë‚˜ì€ ìœ ì—°ì„±ì„ ì œê³µí•˜ê³ , HttpSessionì— í•„ìš”í•  ë•Œë§Œ ì €ì¥í•¨ìœ¼ë¡œì¨ ì„±ëŠ¥ í–¥ìƒ

-----
### SecurityContext ìƒì„±, ì €ì¥, ì‚­ì œ
-----
1. ìµëª… ì‚¬ìš©ì
   - SecurityContextRepositoryë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œìš´ SecurityContext ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ SecurityContextHolderì— ì €ì¥ í›„ ë‹¤ìŒ í•„í„°ë¡œ ì „ë‹¬
   - AnonymousAuthenticationFilterì—ì„œ AnonymousAuthenticationToken ê°ì²´ë¥¼ SecurityContextì— ì €ì¥

2. ì¸ì¦ ìš”ì²­
   - SecurityContextRepositoryë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œìš´ SecurityContext ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ SecurityContextHolderì— ì €ì¥ í›„ ë‹¤ìŒ í•„í„°ë¡œ ì „ë‹¬
   - UsernamePasswordAuthenticationFilterì—ì„œ ì¸ì¦ ì„±ê³µ í›„, SecurityContextì— UsernamePasswordAuthentication ê°ì²´ë¥¼ ì €ì¥
   - SecurityContextRepositoryë¥¼ ì‚¬ìš©í•˜ì—¬ HttpSessionì— SecurityContext ì €ì¥ (Form ì¸ì¦ì˜ ê²½ìš°ì—ëŠ” ì²˜ë¦¬)

3. ì¸ì¦ í›„ ìš”ì²­
   - SecurityContextRepositoryë¥¼ ì‚¬ìš©í•˜ì—¬ HttpSessionì—ì„œ SecurityContextë¥¼ êº¼ë‚´ì–´ SecurityContextHolderì—ì„œ ì €ì¥ í›„ ë‹¤ìŒ í•„í„°ë¡œ ì „ë‹¬
   - SecurityContext ì•ˆì— Authentication ê°ì²´ê°€ ì¡´ì¬í•˜ë©´ ê³„ì† ì¸ì¦ ìœ ì§€

4. í´ë¼ì´ì–¸íŠ¸ ì‘ë‹µ ì‹œ ê³µí†µ
   - SecurityContextHolder.clearContext()ë¡œ ì»¨í…ìŠ¤íŠ¸ ì‚­ì œ (ğŸ’¡ Thread Poolì˜ Threadì¼ ê²½ìš° ë°˜ë“œì‹œ í•„ìš”)

-----
### SecurityContextHolderFilter íë¦„ë„
-----
<div align="center">
<img src="https://github.com/user-attachments/assets/472a46e6-42f8-4d5f-a714-1f652c3db748">
</div>

-----
### SecurityContextHolderFilter & SecurityContextPersistenceFilter
----
<div align="center">
<img src="https://github.com/user-attachments/assets/45642d5b-ed2c-4a8c-857c-bc2f410cb70a">
</div>

-----
### securityContex() API
-----
```java
@Bean
public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
    http.securityContext(securityContext ->
        securityContext.requiredExplicitSave(true); // SecurityContextë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì €ì¥í•  ê²ƒì¸ì§€ ì•„ë‹Œì§€ ì—¬ë¶€ ê²°ì • (ê¸°ë³¸ê°’ : true)
                                                    // trueì´ë©´, SecurityContextHolderFilter / falseì´ë©´, SecurityContextPersistenceFilterê°€ ì‹¤í–‰
    return http.build();
}
```
  - í˜„ì¬ SecurityContextPersistenceFilterëŠ” Deprecated ë˜ì—ˆìœ¼ë¯€ë¡œ, ë ˆê±°ì‹œ ì‹œìŠ¤í…œ ì™¸ì—ëŠ” SecurityContextHolderFilterë¥¼ ì‚¬ìš©í•˜ë©´ ë¨

-----
### CustomAuthenticationFilter & SecurityContextRepository
-----
1. ì»¤ìŠ¤í…€ í•œ ì¸ì¦ í•„í„°ë¥¼ êµ¬í˜„í•  ê²½ìš° ì¸ì¦ì´ ì™„ë£Œëœ í›„ SecurityContextë¥¼ SecurityContextHolderì— ì„¤ì •í•œ í›„ securityContextRepositoryì— ì €ì¥í•˜ê¸° ìœ„í•œ ì½”ë“œë¥¼ ëª…ì‹œì  ì‘ì„±í•´ì¤˜ì•¼ í•˜
```java
securityContextHolderStrategy.setContext(context);
securityContextRepository.saveContext(context, request, response);
```
2. SecurityContextRepositoryëŠ” HttpSessionSecurityContextRepository í˜¹ì€ DelegatingSecurityContextRepositoryë¥¼ ì‚¬ìš©í•˜ë©´ ë¨

-----
### ì½”ë“œ
-----
1. ì´ˆê¸°í™” ê³¼ì •
   - SecurityContextConfigurer
```java
private boolean requireExplicitSave = true;

public void configure(H http) {
     SecurityContextRepository securityContextRepository = this.getSecurityContextRepository();
     if (this.requireExplicitSave) { // ëª…ì‹œì  ì €ì¥
         SecurityContextHolderFilter securityContextHolderFilter = (SecurityContextHolderFilter)this.postProcess(new SecurityContextHolderFilter(securityContextRepository));
         securityContextHolderFilter.setSecurityContextHolderStrategy(this.getSecurityContextHolderStrategy());
         http.addFilter(securityContextHolderFilter);
     } else { // false
         SecurityContextPersistenceFilter securityContextFilter = new SecurityContextPersistenceFilter(securityContextRepository);
         securityContextFilter.setSecurityContextHolderStrategy(this.getSecurityContextHolderStrategy());
         SessionManagementConfigurer<?> sessionManagement = (SessionManagementConfigurer)http.getConfigurer(SessionManagementConfigurer.class);
         SessionCreationPolicy sessionCreationPolicy = sessionManagement != null ? sessionManagement.getSessionCreationPolicy() : null;
         if (SessionCreationPolicy.ALWAYS == sessionCreationPolicy) {
             securityContextFilter.setForceEagerSessionCreation(true);
             http.addFilter((Filter)this.postProcess(new ForceEagerSessionCreationFilter()));
         }
   
         securityContextFilter = (SecurityContextPersistenceFilter)this.postProcess(securityContextFilter);
         http.addFilter(securityContextFilter);
     }
}

SecurityContextRepository getSecurityContextRepository() {
     SecurityContextRepository securityContextRepository = (SecurityContextRepository)((HttpSecurityBuilder)this.getBuilder()).getSharedObject(SecurityContextRepository.class);
     if (securityContextRepository == null) {
         securityContextRepository = new DelegatingSecurityContextRepository(new SecurityContextRepository[]{new RequestAttributeSecurityContextRepository(), new HttpSessionSecurityContextRepository()});
     }
   
     return (SecurityContextRepository)securityContextRepository;
}
```

   - AbstractAuthenticationFilterConfigurer
```java
public void configure(B http) throws Exception {
     PortMapper portMapper = (PortMapper)http.getSharedObject(PortMapper.class);
     if (portMapper != null) {
         this.authenticationEntryPoint.setPortMapper(portMapper);
     }

     RequestCache requestCache = (RequestCache)http.getSharedObject(RequestCache.class);
     if (requestCache != null) {
         this.defaultSuccessHandler.setRequestCache(requestCache);
     }

     this.authFilter.setAuthenticationManager((AuthenticationManager)http.getSharedObject(AuthenticationManager.class));
     this.authFilter.setAuthenticationSuccessHandler(this.successHandler);
     this.authFilter.setAuthenticationFailureHandler(this.failureHandler);
     if (this.authenticationDetailsSource != null) {
         this.authFilter.setAuthenticationDetailsSource(this.authenticationDetailsSource);
     }

     SessionAuthenticationStrategy sessionAuthenticationStrategy = (SessionAuthenticationStrategy)http.getSharedObject(SessionAuthenticationStrategy.class);
     if (sessionAuthenticationStrategy != null) {
         this.authFilter.setSessionAuthenticationStrategy(sessionAuthenticationStrategy);
     }

     RememberMeServices rememberMeServices = (RememberMeServices)http.getSharedObject(RememberMeServices.class);
     if (rememberMeServices != null) {
         this.authFilter.setRememberMeServices(rememberMeServices);
     }

     SecurityContextConfigurer securityContextConfigurer = (SecurityContextConfigurer)http.getConfigurer(SecurityContextConfigurer.class);
     if (securityContextConfigurer != null && securityContextConfigurer.isRequireExplicitSave()) {
         SecurityContextRepository securityContextRepository = securityContextConfigurer.getSecurityContextRepository();
         this.authFilter.setSecurityContextRepository(securityContextRepository); // authFilter : í¼ ì¸ì¦ í•„í„° (FormLgoinConfigurer)
         // DelegatingSecurityContextRepository ì €ì¥
     }

     this.authFilter.setSecurityContextHolderStrategy(this.getSecurityContextHolderStrategy());
     F filter = (AbstractAuthenticationProcessingFilter)this.postProcess(this.authFilter);
     http.addFilter(filter);
}
```

2. ìµëª… ì‚¬ìš©ì
   - SecurityContextHolderFilter
```java
private void doFilter(HttpServletRequest request, HttpServletResponse response, FilterChain chain) throws ServletException, IOException {
     if (request.getAttribute(FILTER_APPLIED) != null) {
         chain.doFilter(request, response);
     } else {
         request.setAttribute(FILTER_APPLIED, Boolean.TRUE);
         Supplier<SecurityContext> deferredContext = this.securityContextRepository.loadDeferredContext(request); // SecurityContextë¥¼ SecurityContextRepositoryì—ì„œ ê°€ì ¸ì˜´ (1. HttpSessionSecurityContextRepository)

         try {
             this.securityContextHolderStrategy.setDeferredContext(deferredContext); // 2. RequestAttributeSecurityContextRepository
             chain.doFilter(request, response);
         } finally {
             this.securityContextHolderStrategy.clearContext();
             request.removeAttribute(FILTER_APPLIED);
         }
     }
}
```

   - HttpSessionSecurityContextRepository
```java
public DeferredSecurityContext loadDeferredContext(HttpServletRequest request) {
     Supplier<SecurityContext> supplier = () -> {
         return this.readSecurityContextFromSession(request.getSession(false)); // Supplierë¥¼ ì‚¬ìš©í•˜ëŠ” ì‹œì ì— í™•ì¸ (ì§€ì—° ë¡œë”©)
     };
     return new SupplierDeferredSecurityContext(supplier, this.securityContextHolderStrategy);
}

private SecurityContext readSecurityContextFromSession(HttpSession httpSession) {
     if (httpSession == null) {
         this.logger.trace("No HttpSession currently exists");
         return null;
     } else {
         Object contextFromSession = httpSession.getAttribute(this.springSecurityContextKey);
         if (contextFromSession == null) {
             if (this.logger.isTraceEnabled()) {
                 this.logger.trace(LogMessage.format("Did not find SecurityContext in HttpSession %s using the SPRING_SECURITY_CONTEXT session attribute", httpSession.getId()));
             }
   
             return null;
         } else if (!(contextFromSession instanceof SecurityContext)) {
             this.logger.warn(LogMessage.format("%s did not contain a SecurityContext but contained: '%s'; are you improperly modifying the HttpSession directly (you should always use SecurityContextHolder) or using the HttpSession attribute reserved for this class?", this.springSecurityContextKey, contextFromSession));
             return null;
         } else {
             if (this.logger.isTraceEnabled()) {
                 this.logger.trace(LogMessage.format("Retrieved %s from %s", contextFromSession, this.springSecurityContextKey));
             } else if (this.logger.isDebugEnabled()) {
                 this.logger.debug(LogMessage.format("Retrieved %s", contextFromSession));
             }
   
             return (SecurityContext)contextFromSession;
         }
     }
}
```

   - RequestAttributeSecurityContextRepository
```java
public DeferredSecurityContext loadDeferredContext(HttpServletRequest request) {
     Supplier<SecurityContext> supplier = () -> { // Sessionì´ ì•„ë‹Œ Request
         return this.getContext(request);
     };
     return new SupplierDeferredSecurityContext(supplier, this.securityContextHolderStrategy);
}
```

   - AnonymousAuthenticationFilter
```java
public void doFilter(ServletRequest req, ServletResponse res, FilterChain chain) throws IOException, ServletException {
     Supplier<SecurityContext> deferredContext = this.securityContextHolderStrategy.getDeferredContext(); // RequestAttributeSecurityContextRepository, HttpSessionSecurityContextRepository
     this.securityContextHolderStrategy.setDeferredContext(this.defaultWithAnonymous((HttpServletRequest)req, deferredContext));
     chain.doFilter(req, res);
}

private SecurityContext defaultWithAnonymous(HttpServletRequest request, SecurityContext currentContext) {
     Authentication currentAuthentication = currentContext.getAuthentication();
     if (currentAuthentication == null) {
         Authentication anonymous = this.createAuthentication(request);
         if (this.logger.isTraceEnabled()) {
             this.logger.trace(LogMessage.of(() -> {
                 return "Set SecurityContextHolder to " + anonymous;
             }));
         } else {
             this.logger.debug("Set SecurityContextHolder to anonymous SecurityContext");
         }

         SecurityContext anonymousContext = this.securityContextHolderStrategy.createEmptyContext();
         anonymousContext.setAuthentication(anonymous);
         return anonymousContext;
     } else {
         if (this.logger.isTraceEnabled()) {
             this.logger.trace(LogMessage.of(() -> {
                 return "Did not set SecurityContextHolder since already authenticated " + currentAuthentication;
             }));
         }

         return currentContext;
     }
}

protected Authentication createAuthentication(HttpServletRequest request) {
     AnonymousAuthenticationToken token = new AnonymousAuthenticationToken(this.key, this.principal, this.authorities);
     token.setDetails(this.authenticationDetailsSource.buildDetails(request));
     return token;
}
```

   - Supplierë¡œ ê°ì‹¸ì§„ SecurityContextRepository ì‚¬ìš© ì‹œì  : AuthorizationFilter (ì¸ê°€ ê´€ë ¨ í•„í„°)
```java
private Authentication getAuthentication() {
     Authentication authentication = this.securityContextHolderStrategy.getContext().getAuthentication(); // í•´ë‹¹ ìš”ì²­ ì‚¬ìš©ìê°€ ì–´ë–¤ ì¸ì¦ ê°ì²´ë¥¼ ê°€ì§€ê³  ìˆëŠ”ì§€ í™•ì¸ì„ ìœ„í•´ ì‚¬ìš©
     if (authentication == null) {
         throw new AuthenticationCredentialsNotFoundException("An Authentication object was not found in the SecurityContext");
     } else {
         return authentication;
     }
}
```

3. ì¸ì¦ ê³¼ì •
   - AbstractAuthenticationProcessingFilter (UssernamePasswordAuthenticationFilter)
```java
// ì¸ì¦ ì„±ê³µ
protected void successfulAuthentication(HttpServletRequest request, HttpServletResponse response, FilterChain chain, Authentication authResult) throws IOException, ServletException {
     SecurityContext context = this.securityContextHolderStrategy.createEmptyContext();
     context.setAuthentication(authResult);
     this.securityContextHolderStrategy.setContext(context);
     this.securityContextRepository.saveContext(context, request, response); // DelegatingSecurityContextRepository
     if (this.logger.isDebugEnabled()) {
         this.logger.debug(LogMessage.format("Set SecurityContextHolder to %s", authResult));
     }

     this.rememberMeServices.loginSuccess(request, response, authResult);
     if (this.eventPublisher != null) {
         this.eventPublisher.publishEvent(new InteractiveAuthenticationSuccessEvent(authResult, this.getClass()));
     }

     this.successHandler.onAuthenticationSuccess(request, response, authResult);
}
```

   - SecurityContextHolderFilter
```java
private void doFilter(HttpServletRequest request, HttpServletResponse response, FilterChain chain) throws ServletException, IOException {
     if (request.getAttribute(FILTER_APPLIED) != null) {
         chain.doFilter(request, response);
     } else {
         request.setAttribute(FILTER_APPLIED, Boolean.TRUE);
         Supplier<SecurityContext> deferredContext = this.securityContextRepository.loadDeferredContext(request); // SecurityContextë¥¼ SecurityContextRepositoryì—ì„œ ê°€ì ¸ì˜´ (1. HttpSessionSecurityContextRepository)

         try {
             this.securityContextHolderStrategy.setDeferredContext(deferredContext); // 2. RequestAttributeSecurityContextRepository
             chain.doFilter(request, response);
         } finally {
             this.securityContextHolderStrategy.clearContext();
             request.removeAttribute(FILTER_APPLIED);
         }
     }
}
```

   - DelegatingSecurityContextRepository
```java
public void saveContext(SecurityContext context, HttpServletRequest request, HttpServletResponse response) {
      Iterator var4 = this.delegates.iterator();
      
      while(var4.hasNext()) {
         SecurityContextRepository delegate = (SecurityContextRepository)var4.next();
         delegate.saveContext(context, request, response);
      }
}
```

   - HttpSessionSecurityContextRepository
```java
public void saveContext(SecurityContext context, HttpServletRequest request, HttpServletResponse response) {
     SaveContextOnUpdateOrErrorResponseWrapper responseWrapper = (SaveContextOnUpdateOrErrorResponseWrapper)WebUtils.getNativeResponse(response, SaveContextOnUpdateOrErrorResponseWrapper.class);
     if (responseWrapper == null) {
         this.saveContextInHttpSession(context, request);
     } else {
         responseWrapper.saveContext(context);
     }
}

private void setContextInSession(SecurityContext context, HttpSession session) {
     if (session != null) {
         session.setAttribute(this.springSecurityContextKey, context);
         if (this.logger.isDebugEnabled()) {
             this.logger.debug(LogMessage.format("Stored %s to HttpSession [%s]", context, session));
         }
     }
}
```

4. ì¸ì¦ ì™„ë£Œ í›„ ìš”ì²­
   - Supplierë¡œ ê°ì‹¸ì§„ SecurityContextRepository ì‚¬ìš© ì‹œì  : AuthorizationFilter (ì¸ê°€ ê´€ë ¨ í•„í„°)
```java
private Authentication getAuthentication() {
     Authentication authentication = this.securityContextHolderStrategy.getContext().getAuthentication(); // í•´ë‹¹ ìš”ì²­ ì‚¬ìš©ìê°€ ì–´ë–¤ ì¸ì¦ ê°ì²´ë¥¼ ê°€ì§€ê³  ìˆëŠ”ì§€ í™•ì¸ì„ ìœ„í•´ ì‚¬ìš© (ì—¬ê¸°ì„œëŠ” ì„¸ì…˜ìœ¼ë¡œë¶€í„° ê°€ì ¸ì˜´)
     if (authentication == null) {
         throw new AuthenticationCredentialsNotFoundException("An Authentication object was not found in the SecurityContext");
     } else {
         return authentication;
     }
}
```

   - HttpSessionSecurityContextRepository
```java
private SecurityContext readSecurityContextFromSession(HttpSession httpSession) {
     if (httpSession == null) {
         this.logger.trace("No HttpSession currently exists");
         return null;
     } else {
         Object contextFromSession = httpSession.getAttribute(this.springSecurityContextKey);
         if (contextFromSession == null) {
             if (this.logger.isTraceEnabled()) {
                 this.logger.trace(LogMessage.format("Did not find SecurityContext in HttpSession %s using the SPRING_SECURITY_CONTEXT session attribute", httpSession.getId()));
             }
   
             return null;
         } else if (!(contextFromSession instanceof SecurityContext)) {
             this.logger.warn(LogMessage.format("%s did not contain a SecurityContext but contained: '%s'; are you improperly modifying the HttpSession directly (you should always use SecurityContextHolder) or using the HttpSession attribute reserved for this class?", this.springSecurityContextKey, contextFromSession));
             return null;
         } else {
             if (this.logger.isTraceEnabled()) {
                 this.logger.trace(LogMessage.format("Retrieved %s from %s", contextFromSession, this.springSecurityContextKey));
             } else if (this.logger.isDebugEnabled()) {
                 this.logger.debug(LogMessage.format("Retrieved %s", contextFromSession));
             }
   
             return (SecurityContext)contextFromSession;
         }
     }
}
```
